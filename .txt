from django.shortcuts import render,redirect
from django.http import HttpResponse
from SMS.models import Student
import random

# Create your views here.
def get_rollno(request):
    oldroll = str(request.POST.get('txtrollno'))
    r = 'AV21-'
    j = str(random.randrange(10,100))
    newroll = r+oldroll+j
    return newroll

def get_name(request):
    oldname = str(request.POST.get('txtname'))
    newname = oldname.title()
    return newname

def get_address(request):
    oldad =str(request.POST.get('txtadrs','NA'))
    newad = oldad.title()
    return newad



def student_login(request):
    if request.method == 'GET':
        return render(request, 'SMS/home.html')
    elif "btnreg" in request.POST:
        return redirect(newregis)

def Id_catcher(d):
    d1 = {'st':d}
    return d1['st']

def newregis(request):
    if request.method == 'GET':
        return render(request, 'SMS/nregister.html')
    elif request.method == 'POST':
        st = Student()
        st.name = get_name(request)
        st.rollno = get_rollno(request)
        st.dob = request.POST.get("txtage","NA")
        st.mobile_no = request.POST.get("txtmbn","NA")
        st.email = request.POST.get("txteml","NA")
        st.address = get_address(request)
        st.save()
        s = st.id
        st = Student.objects.get(id=st.id)
        d1 = {'st':st}
        Id_catcher(s)
        print(d1['st'])
        if 'loginsubmit' in request.POST:
            return redirect('SMS/home.html')
        return render(request, 'SMS/login.html', context=d1)

def login_submit(request):
    if request.method == 'GET':
        i = Id_catcher(request)
        st = Student.objects.filter(id=i)
        d1 = {'st':st}
        return render(request, 'SMS/login2.html', context=d1)

            
def edit_stu(request, id):
    if request.method == 'GET':
        stud = Student.objects.get(id=id)
        d1 = {'stu': stud}
        print(d1['stu'])
        return render(request, 'SMS/final_Edit.html', context=d1)
    elif request.method == 'POST':
        st = Student()
        if Student.objects.filter(id=id).exists():
            st.name = request.POST.get("txtname","NA")
            st.rollno = request.POST.get("txtrollno","NA")
            st.dob = request.POST.get("txtage","NA")
            st.mobile_no = request.POST.get("txtmbn","NA")
            st.email = request.POST.get("txteml","NA")
            st.address = request.POST.get("txtadrs","NA")
            Student.objects.filter(id=id).update(name=st.name,rollno=st.rollno,dob=st.dob,mobile_no=st.mobile_no,email=st.email,address=st.address)
            st = Student.objects.get(id=id)
            print(st)
            return render(request, 'SMS/login.html', {'st':st})

def del_student(request,id):
    if request.method == 'GET':
        Student.objects.filter(id=id).delete()
        return redirect("SMS/home.html")